<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIF Animado desde BIN</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        canvas { background: black; }
    </style>
</head>
<body>
    <h1>Animaci√≥n desde BIN</h1>
    <canvas id="canvas"></canvas>
    <script>
        async function loadBinaryFile(url) {
            const response = await fetch(url);
            const arrayBuffer = await response.arrayBuffer();
            return new DataView(arrayBuffer);
        }

        async function displayAnimation() {
            const data = await loadBinaryFile('pixels.bin');

            // ‚úÖ CORRECCI√ìN: Leer width y height como enteros de 16 bits (2 bytes cada uno)
            const width = data.getUint16(0, true);
            const height = data.getUint16(2, true);
            const frameDuration = data.getUint16(4, true);
            const totalPixels = width * height;
            const frameSize = totalPixels * 3; // Cada p√≠xel tiene 3 bytes (RGB)
            const totalFrames = (data.byteLength - 6) / frameSize; // Restamos los 6 bytes de metadatos

            console.log(`üìÇ Archivo BIN cargado`);
            console.log(`üìè Resoluci√≥n: ${width}x${height}`);
            console.log(`üéûÔ∏è Total de frames: ${totalFrames}`);
            console.log(`‚è≥ Duraci√≥n de cada frame: ${frameDuration}ms`);

            const canvas = document.getElementById("canvas");
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");
            const imageData = ctx.createImageData(width, height);

            let currentFrame = 0;

            function renderFrame() {
                const frameStart = 6 + currentFrame * frameSize; // ‚¨ÖÔ∏è Saltamos los 6 bytes de metadatos
                let pixelIndex = 0;

                for (let i = 0; i < frameSize; i += 3) {
                    imageData.data[pixelIndex++] = data.getUint8(frameStart + i);     // R
                    imageData.data[pixelIndex++] = data.getUint8(frameStart + i + 1); // G
                    imageData.data[pixelIndex++] = data.getUint8(frameStart + i + 2); // B
                    imageData.data[pixelIndex++] = 255; // Alpha (opaco)
                }

                ctx.putImageData(imageData, 0, 0);
                currentFrame = (currentFrame + 1) % totalFrames;
                setTimeout(renderFrame, frameDuration);
            }

            renderFrame();
        }

        displayAnimation();
    </script>
</body>
</html>
